# Простая реферальная система

## Стек
- Python
- Django, DRF
- PostgreSQL
- Redis
- Docker, Docker-compose

## Как запустить
1. Установить docker и docker-compose
2. Перейти в infra и запустить docker-compose, благодаря чему запустятся postgresql и redis
```bash
cd infra
docker-compose up -d
```
3. Перейти на директорию выше и запустить сам django проект
```bash
cd ..
docker-compose up -d
```

После этих шагов приложение будет доступно по порту 8000.


## Описание API
Для работы с API приложения и его документацией есть Swagger и ReDoc. Ими можно воспользоваться после запуска приложения, перейдя по http://127.0.0.1:8000/api/docs и http://127.0.0.1:8000/api/redoc соответственно.

Приложение реализовывает следующие ручки:

| Путь                   | Метод | Описание                                                         | Формат запроса                                                                                                                                     | Формат ответа                                                                                                                                                                                                                                                           |
|------------------------|-------|------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| /api/v1/auth/status    | GET   | Проверяет авторизован ли пользователь                            | -                                                                                                                                                  | Словарь с одним из сообщений:<br/>Вы авторизованы<br/>Вы не авторизованы<br/>Со статусами 200 и 401 соответственно                                                                                                                                                      |
| /api/v1/auth/logout    | POST  | Пользователь выходит из аккаунты                                 | -                                                                                                                                                  | Словарь с одним из сообщений:<br/>Вы теперь не авторизованы<br/>Вы не авторизованы<br/>Со статусами 200 и 401 соответственно                                                                                                                                            |
| /api/v1/auth/send-code | POST  | Отправка смс-кода подтверждения для авторизации<br/>\**Замокано* | Словарь с номером телефона                                                                                                                         | Словарь с сообщением об успешной отправке<br/> И с кодом подтверждения, если *MOCK_PHONE_SENDER=True* в настройках приложения.<br/><br/>Если номер телефона в некорректном формате, то словарь с сообщением об ошибке и 400 статус                                      |
| /api/v1/auth/confirm   | POST  | Подтверждение авторизации с использование кода подтверждения     | Словарь с номером телефона и кодом подтверждения                                                                                                   | Словарь с сообщением об успешной авторизации<<br/><br/>Если номер телефона и/или код подтвержденмия в некорректном формате, то словарь с сообщением об ошибке и 400 статус<br/><br/>Если код неверный, то словарь с сообщением об ошибке и 401 статус                   |
| /api/v1/profile        | GET   | Получение профиля пользователя                                   | Пользователь должен быть авторизован (корректный csrftoken в куках)                                                                                | Словарь с номером телефона, инвайт кодом и введённым пользователем реферальным кодом<br/><br/>Если пользователь неавторизован, то сообщение об этом и статус 401<br/><br/>Если входные данные некорректны, то словарь с сообщением об ошибке и 400 статус               |
| /api/v1/profile/activate_referral_code        | POST  | Активация реферального кода                                      | Пользователь должен быть авторизован (корректный csrftoken в куках и этот же токен в заголовке X-CSRFToken)<br/>Словарь с реферальным кодом        | Словарь с сообщением об успешной активации<br/><br/>Если пользователь неавторизован, то сообщение об этом и статус 401<br/><br/>Если пользователь уже вводил код ранее или код некорректен, или такого кода несуществует, то сообщение с ошибкой и статус 400<br/><br/> |
| /api/v1/profile/referrals        | GET   | Получение списка рефералов с пагинацией                          | Пользователь должен быть авторизован (корректный csrftoken в куках)<br/>Парамтеры запроса в виде номера страницы и количеством записей на страницу | Список номеров рефералов<br/><br/>Если пользователь неавторизован, то сообщение об этом и статус 401                   |

### API с примерами из swagger
- /api/v1/auth/status
<img width="1878" height="953" alt="image" src="https://github.com/user-attachments/assets/83b0c611-cc29-488d-b7d3-efed1ce1aa1c" />

- /api/v1/auth/send-code
<img width="1878" height="953" alt="image" src="https://github.com/user-attachments/assets/a6ad04f5-5250-44cf-9850-e23d7a8c2442" />

- /api/v1/auth/confirm
<img width="1878" height="953" alt="image" src="https://github.com/user-attachments/assets/29756bd0-f2e1-4408-afd5-c4d3f4098866" />

- /api/v1/auth/logout
<img width="1878" height="953" alt="image" src="https://github.com/user-attachments/assets/748e183c-8190-42f6-9474-1fe66c94288c" />

- /api/v1/profile
<img width="1878" height="953" alt="image" src="https://github.com/user-attachments/assets/59f1b1d7-788c-492d-a81b-05944d99e7d8" />

- /api/v1/profile/activate_referral_code
<img width="1878" height="953" alt="image" src="https://github.com/user-attachments/assets/a719fcd5-c867-42a9-9c2f-485a662d4adc" />

- /api/v1/profile/referrals
<img width="1878" height="953" alt="image" src="https://github.com/user-attachments/assets/18769cfb-b84c-47e8-bd46-933773433c1a" />












